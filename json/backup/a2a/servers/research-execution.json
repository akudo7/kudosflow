{
  "config": {
    "recursionLimit": 100,
    "eventEmitter": {
      "defaultMaxListeners": 20
    },
    "mcpServers": {
      "config": {
        "throwOnLoadError": false,
        "prefixToolNameWithServerName": true,
        "additionalToolNamePrefix": "mcp"
      }
    },
    "a2aEndpoint": {
      "port": 3002,
      "agentCard": {
        "name": "ResearchExecutionAgent",
        "description": "èª¿æŸ»å®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ - ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã«åŸºã¥ã„ã¦Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã€èª¿æŸ»çµæœã‚’åé›†ã—ã¾ã™",
        "supportedMessageFormats": [
          "text/plain",
          "application/json"
        ],
        "acceptedInputs": [
          {
            "name": "task_description",
            "description": "å®Ÿè¡Œã™ã‚‹å€‹åˆ¥ã‚¿ã‚¹ã‚¯ã®èª¬æ˜ï¼ˆobjective ã¨ success_criteria ã‚’å«ã‚€ï¼‰"
          }
        ],
        "producedOutputs": [
          {
            "name": "research_results",
            "description": "ã‚¿ã‚¹ã‚¯ã®èª¿æŸ»çµæœã¨ã‚½ãƒ¼ã‚¹æƒ…å ±"
          }
        ]
      }
    }
  },
	"mcpServers": {
		"tavily-mcp": {
			"command": "npx",
			"args": ["-y", "tavily-mcp@0.1.4"]
		}
	},
  "models": [
    {
      "id": "researchModel",
      "type": "OpenAI",
      "config": {
        "model": "gpt-4o-mini",
        "temperature": 0.3
      },
      "bindMcpServers": true,
      "systemPrompt": "ã‚ãªãŸã¯å¸‚å ´èª¿æŸ»ã‚’å°‚é–€ã¨ã™ã‚‹ãƒªã‚µãƒ¼ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n\nã€é‡è¦ãªåˆ¶ç´„ã€‘\n- ã‚¿ã‚¹ã‚¯èª¬æ˜ã«å«ã¾ã‚Œã‚‹ä¼æ¥­åãƒ»çµ„ç¹”åã‚’**ãã®ã¾ã¾ä½¿ç”¨**ã—ã¦ãã ã•ã„\n- ä¼æ¥­åãƒ»çµ„ç¹”åã‚’æ¨æ¸¬ã—ãŸã‚Šå¤‰æ›´ã—ãŸã‚Šã—ãªã„ã§ãã ã•ã„\n- èª¿æŸ»å¯¾è±¡ã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸåç§°ã‚’æ­£ç¢ºã«æ¤œç´¢ã‚¯ã‚¨ãƒªã«å«ã‚ã¦ãã ã•ã„\n\nã€è²¬ä»»ã€‘\n1. ã‚¿ã‚¹ã‚¯èª¬æ˜ã«åŸºã¥ã„ã¦åŒ…æ‹¬çš„ãªèª¿æŸ»ã‚’å®Ÿè¡Œã™ã‚‹\n2. Webæ¤œç´¢ãƒ„ãƒ¼ãƒ«ï¼ˆmcp__tavily-mcp__tavily-searchï¼‰ã‚’ä½¿ç”¨ã—ã¦é–¢é€£æƒ…å ±ã‚’åé›†ã™ã‚‹\n3. åé›†ã—ãŸæƒ…å ±ã‚’æ§‹é€ åŒ–ã—ã¦æ•´ç†ã™ã‚‹\n4. ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‚’ç‰¹å®šã—ã€å¼•ç”¨ã™ã‚‹\n5. èª¿æŸ»çµæœã‚’è©³ç´°ã«ã¾ã¨ã‚ã‚‹\n\nã€â˜…é‡è¦: ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã®ãƒ«ãƒ¼ãƒ«ã€‘\n- Webæ¤œç´¢ãƒ„ãƒ¼ãƒ«ï¼ˆmcp__tavily-mcp__tavily-searchï¼‰ã¯**1å›ã®ã¿**ä½¿ç”¨ã§ãã¾ã™\n- è¤‡æ•°ã®æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã¯ã€1å›ã®å‘¼ã³å‡ºã—ã§åŒ…æ‹¬çš„ãªã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„\n- ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã‚’å—ã‘å–ã£ãŸã‚‰ã€**å¿…ãš**ãã‚Œã‚’ä½¿ã£ã¦æœ€çµ‚çš„ãªèª¿æŸ»å ±å‘Šã‚’ä½œæˆã—ã¦ãã ã•ã„\n- ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå¾Œã«å†åº¦ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ã“ã¨ã¯**ç¦æ­¢**ã•ã‚Œã¦ã„ã¾ã™\n- ãƒ„ãƒ¼ãƒ«çµæœã‚’å—ã‘å–ã£ãŸå¾Œã¯ã€ãã®æƒ…å ±ã‚’åˆ†æãƒ»çµ±åˆã—ã¦è©³ç´°ãªå›ç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„\n\nã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° - é‡è¦ã€‘\nãƒ„ãƒ¼ãƒ«å®Ÿè¡ŒãŒã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸå ´åˆã®å¯¾å¿œæ‰‹é †:\n\n1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã™ã‚‹\n   - JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€Œerror: trueã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ„ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã§ã™\n   - errorCountãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ç¾åœ¨ã®è©¦è¡Œå›æ•°ã‚’ç¢ºèªã—ã¦ãã ã•ã„\n\n2. ã‚¨ãƒ©ãƒ¼å›æ•°ã«å¿œã˜ãŸå¯¾å¿œ\n   - 1å›ç›®ï¼ˆerrorCount: 1ï¼‰: ç•°ãªã‚‹æ¤œç´¢ã‚¯ã‚¨ãƒªã§å†è©¦è¡Œã—ã¦ãã ã•ã„\n     ä¾‹: ã€Œä¼šç¤¾å æ¦‚è¦ã€â†’ã€Œä¼šç¤¾å å…¬å¼ã‚µã‚¤ãƒˆã€\n   - 2å›ç›®ï¼ˆerrorCount: 2ï¼‰: ã‚ˆã‚Šç°¡æ½”ã§ä¸€èˆ¬çš„ãªã‚¯ã‚¨ãƒªã§å†è©¦è¡Œã—ã¦ãã ã•ã„\n     ä¾‹: ã€Œä¼šç¤¾åã€ã®ã¿\n   - 3å›ç›®ä»¥ä¸Šï¼ˆerrorCount: 3+ï¼‰: ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨ã‚’ä¸­æ­¢ã—ã€ã‚ãªãŸã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã§å›ç­”ã—ã¦ãã ã•ã„\n\n3. ç¦æ­¢äº‹é …\n   - åŒã˜æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’3å›ä»¥ä¸Šç¹°ã‚Šè¿”ã•ãªã„ã“ã¨\n   - ã‚¨ãƒ©ãƒ¼ãŒç¶šãå ´åˆã€ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’ç¶šã‘ãªã„ã“ã¨\n   - ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã¦åˆ¥ã®ãƒ„ãƒ¼ãƒ«ã‚’è©¦ã•ãªã„ã“ã¨\n\n4. ä»£æ›¿æ‰‹æ®µ\n   - ãƒ„ãƒ¼ãƒ«ãŒåˆ©ç”¨ã§ããªã„å ´åˆã¯ã€ã‚ãªãŸã®è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦å›ç­”ã—ã¦ãã ã•ã„\n   - æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ã€Œæƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€ã¨æ˜ç¤ºã—ã¦ãã ã•ã„\n   - æ¨æ¸¬ã§å›ç­”ã™ã‚‹å ´åˆã¯ã€Œæ¨æ¸¬ã§ã™ãŒã€ã¨æ˜è¨˜ã—ã¦ãã ã•ã„\n\nã€èª¿æŸ»ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€‘\n- ã‚¿ã‚¹ã‚¯ã®ç›®çš„ã¨æˆåŠŸåŸºæº–ã‚’ç†è§£ã™ã‚‹\n- æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’æœ€é©åŒ–ã—ã¦é–¢é€£æ€§ã®é«˜ã„çµæœã‚’å¾—ã‚‹ï¼ˆ1å›ã®æ¤œç´¢ã§æœ€å¤§é™ã®æƒ…å ±ã‚’å–å¾—ï¼‰\n- äº‹å®Ÿã¨æ„è¦‹ã‚’åŒºåˆ¥ã™ã‚‹\n- æƒ…å ±ã®é®®åº¦ã¨ä¿¡é ¼æ€§ã‚’è©•ä¾¡ã™ã‚‹\n- å…¬å¼ã‚µã‚¤ãƒˆã€æ¥­ç•Œãƒ¬ãƒãƒ¼ãƒˆã€ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã‚’å„ªå…ˆçš„ã«å‚ç…§ã™ã‚‹\n\nã€Webæ¤œç´¢ãƒ„ãƒ¼ãƒ«ã€‘\n- ãƒ„ãƒ¼ãƒ«å: mcp__tavily-mcp__tavily-search\n- æ©Ÿèƒ½: Tavilyæ¤œç´¢APIã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢\n- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:\n  - query: æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆæ—¥æœ¬èªãƒ»è‹±èªã®ä¸¡æ–¹ã«å¯¾å¿œï¼‰\n  - search_depth: \"basic\" ã¾ãŸã¯ \"advanced\"ï¼ˆçœç•¥å¯ï¼‰\n  - max_results: çµæœã®æœ€å¤§æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5ï¼‰\n- æˆ»ã‚Šå€¤: æ¤œç´¢çµæœã®URLã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„\n\nã€å‡ºåŠ›å½¢å¼ã€‘\n- æ—¥æœ¬èªã§ã®èª¿æŸ»ä¾é ¼ã«å¯¾å¿œ\n- 300æ–‡å­—ä»¥ä¸Šã®è©³ç´°ãªèª¿æŸ»çµæœã‚’è¿”ã™\n- ã‚½ãƒ¼ã‚¹URLã‚’å¿…ãšå«ã‚ã‚‹ï¼ˆå–å¾—ã§ããŸå ´åˆï¼‰\n- æƒ…å ±ã®ä¿¡é ¼æ€§ã‚’è©•ä¾¡ã™ã‚‹"
    }
  ],
  "stateAnnotation": {
    "name": "AgentState",
    "type": "Annotation.Root"
  },
  "annotation": {
    "messages": {
      "type": "BaseMessage[]",
      "reducer": "(x, y) => x.concat(y)",
      "default": []
    }
  },
  "nodes": [
    {
      "id": "research_executor",
      "handler": {
        "parameters": [
          {
            "name": "state",
            "type": "typeof AgentState.State"
          },
          {
            "name": "model",
            "type": "ModelConfig",
            "modelRef": "researchModel"
          }
        ],
        "function": "console.log('\\n' + '='.repeat(80));\nconsole.log('ğŸ” [ResearchExecution] èª¿æŸ»å®Ÿè¡Œã‚µãƒ¼ãƒèµ·å‹•');\nconsole.log('='.repeat(80));\n\nconst messages = state.messages || [];\nconst lastMessage = messages[messages.length - 1];\n\n// â˜…ãƒ„ãƒ¼ãƒ«çµæœãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\nconst hasToolResult = messages.some(msg => {\n  return (\n    msg.role === 'tool' ||\n    msg.constructor?.name === 'ToolMessage' ||\n    msg.type === 'tool' ||\n    (msg.lc_namespace && Array.isArray(msg.lc_namespace) && msg.lc_namespace.includes('tool'))\n  );\n});\n\nconsole.log('\\nğŸ“Š çŠ¶æ…‹ç¢ºèª:');\nconsole.log('  Total messages:', messages.length);\nconsole.log('  Has tool result:', hasToolResult);\n\nlet userContent = '';\n\n// æœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¢ã™\nfor (const msg of messages) {\n  if (msg.role === 'user' && msg.content) {\n    userContent = msg.content;\n    break;\n  }\n}\n\nconsole.log('  Original task length:', userContent.length, 'chars');\n\nif (!userContent || userContent.length === 0) {\n  console.error('âŒ ã‚¿ã‚¹ã‚¯èª¬æ˜ãŒç©ºã§ã™');\n  return {\n    messages: [\n      {\n        role: 'assistant',\n        content: JSON.stringify({\n          result: {\n            researchResults: [],\n            summary: 'ã‚¨ãƒ©ãƒ¼: ã‚¿ã‚¹ã‚¯èª¬æ˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'\n          }\n        })\n      }\n    ]\n  };\n}\n\ntry {\n  let response;\n  \n  if (!hasToolResult) {\n    // â˜…åˆå›: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n    console.log('\\nğŸ” [åˆå›] Webæ¤œç´¢ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã™');\n    \n    const researchPrompt = `ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã«ã¤ã„ã¦ã€Webæ¤œç´¢ãƒ„ãƒ¼ãƒ«ï¼ˆmcp__tavily-mcp__tavily-searchï¼‰ã‚’ä½¿ç”¨ã—ã¦è©³ç´°ã«èª¿æŸ»ã—ã¦ãã ã•ã„:\n\n${userContent}\n\næŒ‡ç¤º:\n1. æ—¥æœ¬èªã§ã®æ¤œç´¢ã‚’å„ªå…ˆã—ã¦ãã ã•ã„\n2. æ¤œç´¢ã¯1å›ã®ã¿å®Ÿè¡Œã—ã¦ãã ã•ã„\n3. æ¤œç´¢çµæœã®URLã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„\n\nå¿…ãšmcp__tavily-mcp__tavilyãƒ„ãƒ¼ãƒ«ã‚’1å›ã ã‘ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚`;\n    \n    response = await model.invoke([\n      { role: 'user', content: researchPrompt }\n    ]);\n  } else {\n    // â˜…2å›ç›®: ãƒ„ãƒ¼ãƒ«çµæœã‚’ä½¿ã£ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆ\n    console.log('\\nğŸ“ [2å›ç›®] ãƒ„ãƒ¼ãƒ«çµæœã‚’åˆ†æã—ã¦æœ€çµ‚å›ç­”ã‚’ç”Ÿæˆã—ã¾ã™');\n    \n    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´å…¨ä½“ã‚’LLMã«æ¸¡ã™\n    response = await model.invoke(messages);\n  }\n\n  console.log('\\nğŸ¤– LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡');\n  console.log('  Response type:', typeof response);\n  console.log('  Has tool_calls:', !!response.tool_calls);\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    console.log('  Tool calls count:', response.tool_calls.length);\n    response.tool_calls.forEach((tc, idx) => {\n      console.log(`  [${idx + 1}] ${tc.name}`);\n    });\n  } else if (response.content) {\n    console.log('  Content length:', response.content.length, 'chars');\n  }\n\n  return {\n    messages: [response]\n  };\n} catch (error) {\n  console.error('âŒ èª¿æŸ»å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error.message);\n  console.error('  Stack:', error.stack);\n  return {\n    messages: [\n      {\n        role: 'assistant',\n        content: `èª¿æŸ»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`\n      }\n    ]\n  };\n}"
      }
    },
    {
      "id": "tools",
      "type": "ToolNode",
      "useMcpServers": true
    },
    {
      "id": "result_formatter",
      "handler": {
        "parameters": [
          {
            "name": "state",
            "type": "typeof AgentState.State"
          }
        ],
        "function": "console.log('\\nğŸ“‹ [result_formatter] èª¿æŸ»çµæœã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–‹å§‹');\n\nconst messages = state.messages || [];\nlet toolResults = [];\nlet llmResponse = '';\n\n// ãƒ‡ãƒãƒƒã‚°: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€ ã‚’ç¢ºèª\nconsole.log('  Total messages:', messages.length);\nif (messages.length > 0) {\n  console.log('  Last 3 messages:');\n  for (let i = Math.max(0, messages.length - 3); i < messages.length; i++) {\n    const msg = messages[i];\n    console.log(`    [${i}] type=${msg.constructor?.name || typeof msg}, role=${msg.role}, hasContent=${!!msg.content}`);\n  }\n}\n\n// ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã¨LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åé›†\nfor (let i = messages.length - 1; i >= 0; i--) {\n  const msg = messages[i];\n\n  // â˜…æ”¹å–„: ToolMessageã®åˆ¤å®šã‚’æ‹¡å¼µ\n  const isToolMessage = (\n    msg.role === 'tool' ||\n    msg.constructor?.name === 'ToolMessage' ||\n    msg.type === 'tool' ||\n    (msg.lc_namespace && msg.lc_namespace.includes('tool'))\n  );\n\n  if (isToolMessage) {\n    console.log(`  âœ“ Found tool message at index ${i}`);\n    toolResults.unshift(msg.content);\n  } else if (msg.constructor?.name === 'AIMessage') {\n    // â˜…AIMessageã®å ´åˆã€contentãŒã‚ã‚Œã°LLMå›ç­”ã¨ã—ã¦è¨˜éŒ²\n    if (msg.content && typeof msg.content === 'string' && msg.content.length > 0) {\n      console.log(`  âœ“ Found AI response at index ${i}, length:`, msg.content.length);\n      llmResponse = msg.content;\n      break;\n    }\n  } else if (msg.role === 'assistant' && msg.content && typeof msg.content === 'string') {\n    console.log(`  âœ“ Found assistant response at index ${i}`);\n    llmResponse = msg.content;\n    break;\n  }\n}\n\nconsole.log('  Tool results count:', toolResults.length);\nconsole.log('  LLM response length:', llmResponse.length, 'chars');\n\n// ãƒ„ãƒ¼ãƒ«çµæœã®å†…å®¹ã‚’ã‚µãƒãƒªãƒ¼è¡¨ç¤º\nif (toolResults.length > 0) {\n  console.log('  Tool results preview:');\n  toolResults.slice(0, 3).forEach((result, idx) => {\n    const preview = typeof result === 'string' ? result.substring(0, 100) : JSON.stringify(result).substring(0, 100);\n    console.log(`    [${idx}] ${preview}...`);\n  });\n}\n\n// èª¿æŸ»çµæœã®æ§‹ç¯‰\nconst lastMessage = messages[messages.length - 1];\nlet userContent = '';\n\n// å…ƒã®ã‚¿ã‚¹ã‚¯èª¬æ˜ã‚’æ¢ã™\nfor (const msg of messages) {\n  if (msg.role === 'user' && msg.content) {\n    userContent = msg.content;\n    break;\n  }\n}\n\nlet findings = '';\nconst sources = [];\n\n// ãƒ„ãƒ¼ãƒ«çµæœã‹ã‚‰URLã‚’æŠ½å‡º\nfor (const result of toolResults) {\n  try {\n    const parsed = typeof result === 'string' ? JSON.parse(result) : result;\n    if (parsed.results && Array.isArray(parsed.results)) {\n      parsed.results.forEach(r => {\n        if (r.url) sources.push(r.url);\n      });\n    }\n  } catch (e) {\n    // JSONè§£æå¤±æ•—ã¯ç„¡è¦–\n  }\n}\n\n// â˜…æ”¹å–„: ãƒ„ãƒ¼ãƒ«çµæœã¨LLMå›ç­”ã®ä¸¡æ–¹ã‚’è€ƒæ…®\nif (toolResults.length === 0 && llmResponse) {\n  // LLMãŒç›´æ¥å›ç­”ã—ãŸå ´åˆï¼ˆãƒ„ãƒ¼ãƒ«ãªã—ï¼‰\n  findings = llmResponse;\n  console.log('  âœ“ LLMã®ç›´æ¥å›ç­”ã‚’ä½¿ç”¨');\n} else if (toolResults.length > 0) {\n  // â˜…LLMã®æœ€çµ‚å›ç­”ãŒãªã„å ´åˆã¯ã€ãƒ„ãƒ¼ãƒ«çµæœã‚’ç›´æ¥ä½¿ç”¨\n  if (!llmResponse || llmResponse.length === 0) {\n    // ãƒ„ãƒ¼ãƒ«çµæœã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã‚‹\n    findings = `ä»¥ä¸‹ã®æƒ…å ±æºã‹ã‚‰èª¿æŸ»ã—ã¾ã—ãŸ:\\n\\n${toolResults.slice(0, 3).map((r, i) => `${i+1}. ${typeof r === 'string' ? r.substring(0, 200) : JSON.stringify(r).substring(0, 200)}...`).join('\\n\\n')}`;\n    console.log('  âš ï¸ LLMå›ç­”ãªã—ã€ãƒ„ãƒ¼ãƒ«çµæœã‚’ç›´æ¥ä½¿ç”¨');\n  } else {\n    findings = llmResponse;\n    console.log('  âœ“ LLMã®æœ€çµ‚å›ç­”ã‚’ä½¿ç”¨');\n  }\n} else {\n  findings = 'èª¿æŸ»çµæœãªã—';\n  console.log('  âš ï¸ ãƒ„ãƒ¼ãƒ«çµæœã‚‚LLMå›ç­”ã‚‚ãªã—');\n}\n\nconst researchResult = {\n  taskId: 1,\n  objective: userContent.substring(0, 100) + (userContent.length > 100 ? '...' : ''),\n  findings: findings || 'èª¿æŸ»çµæœãªã—',\n  sources: sources.slice(0, 10), // æœ€å¤§10ä»¶\n  completionStatus: findings ? 'completed' : 'error'\n};\n\nconst result = {\n  result: {\n    researchResults: [researchResult],\n    summary: researchResult.completionStatus === 'completed' ? 'èª¿æŸ»ãŒå®Œäº†ã—ã¾ã—ãŸ' : 'èª¿æŸ»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'\n  }\n};\n\nconsole.log('\\nğŸ“Š èª¿æŸ»å®Œäº†');\nconsole.log('  Status:', researchResult.completionStatus);\nconsole.log('  Findings length:', researchResult.findings.length, 'chars');\nconsole.log('  Sources count:', researchResult.sources.length);\nconsole.log('='.repeat(80) + '\\n');\n\nreturn {\n  messages: [\n    {\n      role: 'assistant',\n      content: JSON.stringify(result, null, 2)\n    }\n  ]\n};"
      }
    }
  ],
  "edges": [
    {
      "from": "__start__",
      "to": "research_executor"
    },
    {
      "type": "conditional",
      "from": "research_executor",
      "condition": {
        "name": "needsTools",
        "handler": {
          "parameters": [
            {
              "name": "state",
              "type": "typeof AgentState.State"
            }
          ],
          "output": "string",
          "function": "try {\n  const lastMessage = state.messages[state.messages.length - 1];\n  \n  console.log('\\nğŸ”€ [needsTools] æ¡ä»¶åˆ¤å®š');\n  console.log('  Total messages:', state.messages.length);\n  \n  // â˜…ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœï¼ˆToolMessageï¼‰ã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ\n  const toolResultCount = state.messages.filter(msg => {\n    return (\n      msg.role === 'tool' ||\n      msg.constructor?.name === 'ToolMessage' ||\n      msg.type === 'tool' ||\n      (msg.lc_namespace && Array.isArray(msg.lc_namespace) && msg.lc_namespace.includes('tool'))\n    );\n  }).length;\n  \n  console.log('  Tool result count:', toolResultCount);\n  \n  // â˜…æ—¢ã«ãƒ„ãƒ¼ãƒ«å®Ÿè¡ŒçµæœãŒã‚ã‚‹å ´åˆã¯çµ‚äº†\n  if (toolResultCount >= 1) {\n    console.log('  âœ“ ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã‚ã‚Š (', toolResultCount, 'ä»¶)ã€result_formatterã¸');\n    return 'result_formatter';\n  }\n  \n  // â˜…æœ€åˆã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ï¼ˆtool_callsãŒã‚ã‚‹ãŒã€ã¾ã å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ï¼‰\n  if (\n    lastMessage &&\n    typeof lastMessage === 'object' &&\n    lastMessage.tool_calls &&\n    Array.isArray(lastMessage.tool_calls) &&\n    lastMessage.tool_calls.length > 0\n  ) {\n    console.log('  âœ“ ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’æ¤œå‡º (åˆå›)ã€toolsãƒãƒ¼ãƒ‰ã¸');\n    return 'tools';\n  }\n  \n  console.log('  âœ“ ãƒ„ãƒ¼ãƒ«ä¸è¦ã€result_formatterã¸');\n  return 'result_formatter';\n} catch (error) {\n  console.error('ğŸ”€ [needsTools] ã‚¨ãƒ©ãƒ¼:', error);\n  return 'result_formatter';\n}",
          "possibleTargets": ["tools", "result_formatter"]
        }
      }
    },
    {
      "from": "tools",
      "to": "research_executor"
    },
    {
      "from": "result_formatter",
      "to": "__end__"
    }
  ],
  "stateGraph": {
    "annotationRef": "AgentState",
    "config": {
      "checkpointer": {
        "type": "MemorySaver"
      }
    }
  }
}