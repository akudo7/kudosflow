{
  "config": {
    "info": {
      "version": "1.0.0",
      "description": "Quality evaluation agent for research results",
      "copyright": "Copyright 2026",
      "author": "Akira Kudo"
    },
    "recursionLimit": 100,
    "eventEmitter": {
      "defaultMaxListeners": 20
    },
    "a2aEndpoint": {
      "port": 3003,
      "agentCard": {
        "name": "QualityEvaluationAgent",
        "description": "å“è³ªè©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ - èª¿æŸ»çµæœã®å“è³ªã‚’è©•ä¾¡ã—ã€ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã—ã¾ã™",
        "supportedMessageFormats": [
          "text/plain",
          "application/json"
        ],
        "acceptedInputs": [
          {
            "name": "research_results",
            "description": "è©•ä¾¡ã™ã‚‹èª¿æŸ»çµæœ"
          }
        ],
        "producedOutputs": [
          {
            "name": "quality_evaluation",
            "description": "å“è³ªè©•ä¾¡ã¨ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼"
          }
        ]
      }
    }
  },
  "models": [
    {
      "id": "evaluationModel",
      "type": "OpenAI",
      "config": {
        "model": "gpt-4o-mini",
        "temperature": 0.2
      },
      "systemPrompt": "ã‚ãªãŸã¯å¸‚å ´èª¿æŸ»ã®å“è³ªè©•ä¾¡ã¨ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã‚’å°‚é–€ã¨ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n\nã€é‡è¦ãªåˆ¶ç´„ã€‘\n- èª¿æŸ»çµæœã«å«ã¾ã‚Œã‚‹ä¼æ¥­åãƒ»çµ„ç¹”åã‚’**ãã®ã¾ã¾ä½¿ç”¨**ã—ã¦ãã ã•ã„\n- ä¼æ¥­åãƒ»çµ„ç¹”åã‚’æ¨æ¸¬ã—ãŸã‚Šå¤‰æ›´ã—ãŸã‚Šã—ãªã„ã§ãã ã•ã„\n- ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã«ã¯ã€èª¿æŸ»å¯¾è±¡ã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸåç§°ã‚’æ­£ç¢ºã«è¨˜è¼‰ã—ã¦ãã ã•ã„\n\nè²¬ä»»:\n1. èª¿æŸ»çµæœã®å®Œå…¨æ€§ã¨å“è³ªã‚’è©•ä¾¡ã™ã‚‹\n2. å…ƒã®ãƒ¦ãƒ¼ã‚¶è¦æ±‚ã¨èª¿æŸ»çµæœã‚’ç…§åˆã™ã‚‹\n3. ä¸è¶³ã—ã¦ã„ã‚‹æƒ…å ±ã‚„æ”¹å–„ç‚¹ã‚’ç‰¹å®šã™ã‚‹\n4. åŒ…æ‹¬çš„ãªã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã™ã‚‹\n5. å“è³ªã‚¹ã‚³ã‚¢ã¨æ¨å¥¨äº‹é …ã‚’æä¾›ã™ã‚‹\n\nã€å…¥åŠ›å½¢å¼ã€‘\nã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯2ã¤ã®å…¥åŠ›å½¢å¼ã«å¯¾å¿œã—ã¾ã™:\n\n1. JSONæ§‹é€ å½¢å¼:\n   - originalRequest: å…ƒã®ãƒ¦ãƒ¼ã‚¶è¦æ±‚\n   - researchResults: æ§‹é€ åŒ–ã•ã‚ŒãŸèª¿æŸ»çµæœé…åˆ—\n   - å„çµæœã«ã¯taskId, objective, findings, sourcesã‚’å«ã‚€\n\n2. è‡ªç„¶è¨€èªå½¢å¼:\n   - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚„ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§æ›¸ã‹ã‚ŒãŸèª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ\n   - æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã¯å«ã¾ã‚Œã¦ã„ãªã„\n   - ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’åˆ†æã—ã¦è©•ä¾¡ã‚’è¡Œã†\n\nè©•ä¾¡åŸºæº–:\n- å®Œå…¨æ€§: å…¨ã¦ã®è¦æ±‚ãƒˆãƒ”ãƒƒã‚¯ãŒã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹\n- æ­£ç¢ºæ€§: æƒ…å ±ãŒå…·ä½“çš„ã§æ¤œè¨¼å¯èƒ½ã‹\n- é–¢é€£æ€§: èª¿æŸ»çµæœãŒãƒ¦ãƒ¼ã‚¶è¦æ±‚ã«é–¢é€£ã—ã¦ã„ã‚‹ã‹\n- æ·±ã•: è¡¨é¢çš„ã§ã¯ãªãã€ååˆ†ãªæ·±ã•ãŒã‚ã‚‹ã‹\n- æ§‹é€ : æƒ…å ±ãŒè«–ç†çš„ã«æ•´ç†ã•ã‚Œã¦ã„ã‚‹ã‹\n\nã€è©•ä¾¡æ–¹æ³•ã€‘\n- JSONå½¢å¼: å„èª¿æŸ»çµæœã‚’å€‹åˆ¥ã«è©•ä¾¡ã—ã€å®Œå…¨æ€§ã‚’ãƒã‚§ãƒƒã‚¯\n- è‡ªç„¶è¨€èªå½¢å¼: ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã®å“è³ªã€æ§‹æˆã€å†…å®¹ã®æ·±ã•ã‚’è©•ä¾¡\n- ã©ã¡ã‚‰ã®å½¢å¼ã§ã‚‚ã€å“è³ªã‚¹ã‚³ã‚¢ã¨ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ\n\nã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:\n- ç°¡æ½”ã§è¦ç‚¹ã‚’æŠ¼ã•ãˆãŸæ–‡ç« ï¼ˆ500-800æ–‡å­—ç¨‹åº¦ï¼‰\n- ãƒ¦ãƒ¼ã‚¶ãŒæ±‚ã‚ãŸå…¨ã¦ã®ãƒˆãƒ”ãƒƒã‚¯ã«è¨€åŠ\n- é‡è¦ãªæ•°å€¤ã‚„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚ã‚‹\n- ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­ã«å½¹ç«‹ã¤æ´å¯Ÿã‚’æä¾›\n- æ—¥æœ¬èªã§ä½œæˆï¼ˆæ•¬ä½“ã‚’ä½¿ç”¨ï¼‰\n\nå¿…ãšæ—¥æœ¬èªã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚"
    }
  ],
  "stateAnnotation": {
    "name": "AgentState",
    "type": "Annotation.Root"
  },
  "annotation": {
    "messages": {
      "type": "BaseMessage[]",
      "reducer": "(x, y) => x.concat(y)",
      "default": []
    }
  },
  "nodes": [
    {
      "id": "quality_evaluator",
      "handler": {
        "parameters": [
          {
            "name": "state",
            "parameterType": "state",
            "stateType": "typeof AgentState.State"
          },
          {
            "name": "model",
            "parameterType": "model",
            "modelRef": "evaluationModel"
          }
        ],
        "function": "console.log('\\n' + '='.repeat(80));\nconsole.log('ğŸ“Š [QualityEvaluation] å“è³ªè©•ä¾¡é–‹å§‹');\nconsole.log('='.repeat(80));\n\nconst messages = state.messages;\n\n// æœ€å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰èª¿æŸ»çµæœã‚’æŠ½å‡º\nconst lastMessage = messages[messages.length - 1];\nlet userContent = '';\n\nif (lastMessage) {\n  if (lastMessage.content) {\n    userContent = lastMessage.content;\n  } else if (lastMessage.parts && Array.isArray(lastMessage.parts)) {\n    userContent = lastMessage.parts[0]?.text || lastMessage.parts[0]?.content || '';\n  } else if (typeof lastMessage === 'string') {\n    userContent = lastMessage;\n  }\n}\n\nconsole.log('\\nğŸ“¨ å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ:');\nconsole.log('  Content length:', userContent.length, 'chars');\nconsole.log('  First 300 chars:', userContent.substring(0, 300));\n\n// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è§£æ\nlet originalRequest = '';\nlet researchResults = [];\n\ntry {\n  console.log('\\nğŸ” JSONè§£æé–‹å§‹...');\n  \n  // ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’é™¤å»ã—ã¦JSONéƒ¨åˆ†ã‚’æŠ½å‡º\n  const jsonMatch = userContent.match(/\\{[\\s\\S]*\\}/);\n  \n  if (jsonMatch) {\n    console.log('  âœ“ JSONéƒ¨åˆ†ã‚’æ¤œå‡º');\n    \n    let jsonStr = jsonMatch[0];\n    \n    // JSON5ãƒ©ã‚¤ã‚¯ãªå‡¦ç†: æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«å†…ã®åˆ¶å¾¡æ–‡å­—ã‚’é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—\n    // ã‚ˆã‚Šå …ç‰¢ãªæ–¹æ³•ã¨ã—ã¦ã€JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç›´æ¥evalã™ã‚‹ä»£ã‚ã‚Šã«\n    // ã¾ãštry-catchã§JSON.parseã‚’è©¦ã¿ã€å¤±æ•—ã—ãŸã‚‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n    let evaluationData;\n    try {\n      evaluationData = JSON.parse(jsonStr);\n    } catch (parseError) {\n      console.log('  âš ï¸ æ¨™æº–JSON.parseå¤±æ•—ã€æ–‡å­—åˆ—ä¿®æ­£ã‚’è©¦ã¿ã¾ã™');\n      console.log('    Error:', parseError.message);\n      \n      // æ–‡å­—åˆ—å€¤å†…ã®åˆ¶å¾¡æ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆç°¡æ˜“ç‰ˆï¼‰\n      // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå†…ã®æ”¹è¡Œã€ã‚¿ãƒ–ã€å¾©å¸°ã‚’\\\\n, \\\\t, \\\\rã«å¤‰æ›\n      // æ³¨: ã“ã®æ–¹æ³•ã¯å®Œç’§ã§ã¯ãªã„ãŒã€ä¸€èˆ¬çš„ãªã‚±ãƒ¼ã‚¹ã«ã¯å¯¾å¿œã§ãã‚‹\n      jsonStr = jsonStr.replace(/\"([^\"]*)\"/g, (match, content) => {\n        const escaped = content\n          .replace(/\\n/g, '\\\\n')\n          .replace(/\\r/g, '\\\\r')\n          .replace(/\\t/g, '\\\\t');\n        return `\"${escaped}\"`;\n      });\n      \n      evaluationData = JSON.parse(jsonStr);\n    }\n    console.log('  âœ“ evaluationDataè§£ææˆåŠŸ');\n    console.log('    - originalRequest:', evaluationData.originalRequest?.substring(0, 50));\n    console.log('    - totalResults:', evaluationData.totalResults);\n    \n    originalRequest = evaluationData.originalRequest || '';\n    \n    // researchResultsã‚’ç›´æ¥ä½¿ç”¨ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æ—¢ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–æ¸ˆã¿ï¼‰\n    if (evaluationData.researchResults && Array.isArray(evaluationData.researchResults)) {\n      console.log('  âœ“ researchResultsé…åˆ—ã‚’æ¤œå‡º:', evaluationData.researchResults.length, 'items');\n      researchResults = evaluationData.researchResults;\n      console.log('  âœ… èª¿æŸ»çµæœã‚’ç›´æ¥ä½¿ç”¨:', researchResults.length, 'items');\n    }\n  } else {\n    // â˜…Phase 8: è‡ªç„¶è¨€èªå½¢å¼ã¸ã®å¯¾å¿œ\n    console.log('  âœ“ è‡ªç„¶è¨€èªå½¢å¼ã‚’æ¤œå‡º');\n    console.log('  ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’1ã¤ã®èª¿æŸ»çµæœã¨ã—ã¦å‡¦ç†ã—ã¾ã™');\n\n    // ãƒ¦ãƒ¼ã‚¶è¦æ±‚ã‚’æŠ½å‡ºï¼ˆæœ€åˆã®è¡Œã¾ãŸã¯ã€Œä»¥ä¸‹ã®ã€ä»¥é™ï¼‰\n    const requestMatch = userContent.match(/^([^\\n:ï¼š]+)[ï¼š:]/);\n    if (requestMatch) {\n      originalRequest = requestMatch[1].trim();\n    } else {\n      originalRequest = 'èª¿æŸ»çµæœã®å“è³ªè©•ä¾¡';\n    }\n\n    console.log('  æŠ½å‡ºã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶è¦æ±‚:', originalRequest);\n\n    // ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’1ã¤ã®èª¿æŸ»çµæœã¨ã—ã¦æ‰±ã†\n    researchResults = [{\n      taskId: 1,\n      objective: 'ç·åˆèª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ',\n      findings: userContent,\n      sources: [],\n      format: 'natural_language'\n    }];\n\n    console.log('  âœ… è‡ªç„¶è¨€èªãƒ†ã‚­ã‚¹ãƒˆã‚’èª¿æŸ»çµæœã«å¤‰æ›ã—ã¾ã—ãŸ');\n  }\n} catch (e) {\n  console.error('\\nâŒ JSONè§£æã‚¨ãƒ©ãƒ¼:', e.message);\n  console.error('  ã‚¹ã‚¿ãƒƒã‚¯:', e.stack);\n  console.log('  ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å…¨ä½“ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦æ‰±ã„ã¾ã™');\n\n  // â˜…Phase 8: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚‚æ”¹å–„\n  originalRequest = 'ãƒ†ã‚­ã‚¹ãƒˆè§£æã‚¨ãƒ©ãƒ¼';\n  researchResults = [{\n    taskId: 1,\n    objective: 'ã‚¨ãƒ©ãƒ¼å›å¾©',\n    findings: userContent,\n    sources: []\n  }];\n}\n\nconsole.log('\\nğŸ“‹ è§£æçµæœã‚µãƒãƒªãƒ¼:');\nconsole.log('  å…ƒã®ãƒ¦ãƒ¼ã‚¶è¦æ±‚:', originalRequest.substring(0, 100) + '...');\nconsole.log('  èª¿æŸ»çµæœæ•°:', researchResults.length);\n\n// èª¿æŸ»çµæœãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\nif (researchResults.length === 0) {\n  console.warn('\\nâš ï¸  è­¦å‘Š: èª¿æŸ»çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n  console.log('  ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™');\n  \n  return {\n    messages: [{\n      role: 'assistant',\n      content: JSON.stringify({\n        result: {\n          qualityScore: 0,\n          completenessCheck: {},\n          executiveSummary: 'ã‚¨ãƒ©ãƒ¼: è©•ä¾¡ã™ã‚‹èª¿æŸ»çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚èª¿æŸ»ãƒ•ã‚§ãƒ¼ã‚ºãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',\n          recommendations: ['èª¿æŸ»ãƒ•ã‚§ãƒ¼ã‚ºã‚’å†å®Ÿè¡Œã—ã¦ãã ã•ã„'],\n          missingTopics: ['å…¨ã¦ã®ãƒˆãƒ”ãƒƒã‚¯'],\n          error: 'èª¿æŸ»çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',\n          debugInfo: {\n            receivedContentLength: userContent.length,\n            receivedContentPreview: userContent.substring(0, 500)\n          }\n        }\n      }, null, 2)\n    }]\n  };\n}\n\n// èª¿æŸ»çµæœã‚’æ•´å½¢\nconst findingsSummary = researchResults.map((r, idx) => {\n  const taskId = r.taskId || (idx + 1);\n  const objective = r.objective || 'No objective';\n  const findings = r.findings || r.result || 'No findings';\n  const sources = r.sources || [];\n  const sourcesStr = sources.length > 0 ? `\\nå‡ºå…¸: ${sources.join(', ')}` : '';\n  return `ã‚¿ã‚¹ã‚¯${taskId}: ${objective}\\nçµæœ: ${findings}${sourcesStr}`;\n}).join('\\n\\n');\n\nconsole.log('\\nğŸ“ æ•´å½¢ã•ã‚ŒãŸèª¿æŸ»çµæœï¼ˆfirst 500 charsï¼‰:');\nconsole.log(findingsSummary.substring(0, 500));\n\n// LLMã«è©•ä¾¡ã¨ã‚µãƒãƒªãƒ¼ä½œæˆã‚’ä¾é ¼\nconst evaluationPrompt = `ä»¥ä¸‹ã®å¸‚å ´èª¿æŸ»ã«ã¤ã„ã¦ã€å“è³ªè©•ä¾¡ã¨ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nã€å…ƒã®ãƒ¦ãƒ¼ã‚¶è¦æ±‚ã€‘\n${originalRequest}\n\nã€èª¿æŸ»çµæœã€‘\n${findingsSummary}\n\nä»¥ä¸‹ã®å½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã ã•ã„:\nEVALUATION_START\n{\n  \"qualityScore\": å“è³ªã‚¹ã‚³ã‚¢ï¼ˆ0-100ï¼‰,\n  \"completenessCheck\": {\n    \"å„è¦æ±‚ãƒˆãƒ”ãƒƒã‚¯\": true/falseï¼ˆã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹ï¼‰\n  },\n  \"executiveSummary\": \"æ—¥æœ¬èªã®ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼ˆ500-800æ–‡å­—ï¼‰\",\n  \"recommendations\": [\"æ”¹å–„æ¨å¥¨äº‹é …1\", \"æ”¹å–„æ¨å¥¨äº‹é …2\"],\n  \"missingTopics\": [\"ä¸è¶³ãƒˆãƒ”ãƒƒã‚¯1\", \"ä¸è¶³ãƒˆãƒ”ãƒƒã‚¯2\"]\n}\nEVALUATION_END\n\nè©•ä¾¡åŸºæº–:\n- completenessCheck: å…ƒã®ãƒ¦ãƒ¼ã‚¶è¦æ±‚ã‹ã‚‰å„ãƒˆãƒ”ãƒƒã‚¯ã‚’æŠ½å‡ºã—ã€ã‚«ãƒãƒ¼çŠ¶æ³ã‚’åˆ¤å®š\n- qualityScore: å®Œå…¨æ€§ã€å…·ä½“æ€§ã€é–¢é€£æ€§ã€æ·±ã•ã‚’ç·åˆçš„ã«è©•ä¾¡ï¼ˆ0-100ç‚¹ï¼‰\n- executiveSummary: ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­ã«å½¹ç«‹ã¤ã€ç°¡æ½”ã§åŒ…æ‹¬çš„ãªã‚µãƒãƒªãƒ¼ï¼ˆ500-800æ–‡å­—ï¼‰\n- recommendations: ã•ã‚‰ãªã‚‹èª¿æŸ»ã‚„æ”¹å–„ãŒå¿…è¦ãªç‚¹\n- missingTopics: ã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ãªã„ãƒˆãƒ”ãƒƒã‚¯`;\n\nconsole.log('\\nğŸ¤– LLMã«è©•ä¾¡ä¾é ¼ã‚’é€ä¿¡...');\nconsole.log('  Prompt length:', evaluationPrompt.length, 'chars');\n\n// Model is passed as a parameter\n// Model is now passed as a parameter, so no need to check\n\nconst response = await model.invoke([{\n  role: 'user',\n  content: evaluationPrompt\n}]);\n\nconsole.log('\\nâœ… LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡');\n\nconst content = response.content || '';\nconsole.log('  Response length:', content.length, 'chars');\nconsole.log('  First 300 chars:', content.substring(0, 300));\n\nconst evaluationMatch = content.match(/EVALUATION_START\\s*([\\s\\S]*?)\\s*EVALUATION_END/);\n\nlet evaluation;\n\nif (evaluationMatch) {\n  try {\n    evaluation = JSON.parse(evaluationMatch[1].trim());\n    console.log('\\nâœ… è©•ä¾¡çµæœè§£ææˆåŠŸ');\n    console.log('  Quality Score:', evaluation.qualityScore);\n    console.log('  Executive Summary length:', evaluation.executiveSummary?.length || 0, 'chars');\n    console.log('  Recommendations:', evaluation.recommendations?.length || 0);\n    console.log('  Missing Topics:', evaluation.missingTopics?.length || 0);\n  } catch (e) {\n    console.error('\\nâŒ è©•ä¾¡çµæœJSONè§£æã‚¨ãƒ©ãƒ¼:', e.message);\n    console.log('  ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡ã‚’ä½¿ç”¨ã—ã¾ã™');\n    \n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡\n    evaluation = {\n      qualityScore: 70,\n      completenessCheck: {},\n      executiveSummary: content.substring(0, 800),\n      recommendations: ['è©•ä¾¡çµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ'],\n      missingTopics: []\n    };\n  }\n} else {\n  console.warn('\\nâš ï¸  EVALUATION ãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n  console.log('  ãƒãƒ¼ã‚«ãƒ¼ãªã—ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡ã‚’ä½¿ç”¨ã—ã¾ã™');\n  \n  // ãƒãƒ¼ã‚«ãƒ¼ãªã—ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n  evaluation = {\n    qualityScore: 70,\n    completenessCheck: {},\n    executiveSummary: content.substring(0, 800),\n    recommendations: [],\n    missingTopics: []\n  };\n}\n\n// æœ€çµ‚çµæœã®æ§‹ç¯‰\nconst result = {\n  qualityScore: evaluation.qualityScore,\n  completenessCheck: evaluation.completenessCheck,\n  executiveSummary: evaluation.executiveSummary,\n  recommendations: evaluation.recommendations || [],\n  missingTopics: evaluation.missingTopics || [],\n  researchResults: researchResults\n};\n\nconsole.log('\\nğŸ“‹ è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆå®Œæˆ');\nconsole.log('  å“è³ªã‚¹ã‚³ã‚¢:', result.qualityScore);\nconsole.log('  æ¨å¥¨äº‹é …:', result.recommendations.length);\nconsole.log('  ä¸è¶³ãƒˆãƒ”ãƒƒã‚¯:', result.missingTopics.length);\nconsole.log('  ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼é•·:', result.executiveSummary.length, 'chars');\n\nconsole.log('\\n' + '='.repeat(80));\nconsole.log('âœ… [QualityEvaluation] å“è³ªè©•ä¾¡å®Œäº†');\nconsole.log('='.repeat(80) + '\\n');\n\nreturn {\n  messages: [{\n    role: 'assistant',\n    content: JSON.stringify({ result }, null, 2)\n  }]\n};"
      }
    }
  ],
  "edges": [
    {
      "from": "__start__",
      "to": "quality_evaluator"
    },
    {
      "from": "quality_evaluator",
      "to": "__end__"
    }
  ],
  "stateGraph": {
    "annotationRef": "AgentState",
    "config": {
      "checkpointer": {
        "type": "MemorySaver"
      }
    }
  }
}
